<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<script src="lib/jquery.ui.touch-punch.min.js"></script>
	<link REL="SHORTCUT ICON" HREF="img/qlogo.ico">
	<title>Qmap editor</title>
<style>
			body { 		font-family: Verdana,Geneva,sans-serif; font-size:13px; box-sizing: border-box;
						padding: 0px; margin: 0px;
						}
			.menuBut {	margin-left:16px; margin-right: 16px; margin-top:8px; cursor: pointer;
						}

</style>
</head>

<body>
<div id="mainDiv" style="width:100%;height:calc(100vh - 32px);background-color:#eee"></div>
<div id="menuDiv" style="width:100%;height:32px;background-color:#ccc">
	<img id="moveBut" class="menuBut" src="img/movebut.gif" onclick="SendMsg('menu','move')">
</div>

<script>

var editMode=false;

$(document).ready(function() {								           	// ON PAGE LOADED
	
	
	
	
	if (window.addEventListener) 											// If supported this way
		window.addEventListener("message",html5MessageHandler,false);		// Add event handler
	else																	// Use other method
		window.attachEvent("message",html5MessageHandler);					// Add handler
});

function html5MessageHandler(e)											// ON HTML5 MESSAGE
{
	if (e && e.data) {														// If a valid message				
		if (e.data.match(/QMap=menu/))										// A menu message
			MenuOption(e.data.substr(10));									// Route
		else
			trace(e.data);														// Handle it
		}
}

function SendMsg(type, msg)												// SEND HTML5 MESSAGE
{
	window.postMessage("QMap="+type+"|"+msg,"*");							// Send message to main window
}

function MenuOption(msg)												// ROUTE MENU OPTION
{
	if (msg == "move") {													// Move
		editMode=!editMode;													// Toggle mode
		$("#moveBut").prop("src", editMode ? "img/editbut.gif" : "img/movebut.gif"); // Toggle button
		}
}

function trace(msg, p1, p2, p3, p4)										// CONSOLE 
	{
		if (p4 != undefined)
			console.log(msg,p1,p2,p3,p4);
		else if (p3 != undefined)
			console.log(msg,p1,p2,p3);
		else if (p2 != undefined)
			console.log(msg,p1,p2);
		else if (p1 != undefined)
			console.log(msg,p1);
		else
			console.log(msg);
	}

</script>
</body>
</html>

